# Info model migration job database writer SQL statements
infomigr.step1.writer.sql=UPDATE CERTIFICATE SET DOCUMENT = ? WHERE id = ?

# Info model migration job database reader SQL statements
infomigr.step1.reader.sql.select=SELECT ID, DOCUMENT, CERTIFICATE_ID
infomigr.step1.reader.sql.from=FROM ORIGINAL_CERTIFICATE
infomigr.step1.reader.sql.where=WHERE UTF8TOSTRING(DOCUMENT) LIKE '%<motivering>%' AND UTF8TOSTRING(DOCUMENT) NOT LIKE '%<prognosangivelse>%'
infomigr.step1.reader.sortkey=ID
infomigr.step1.reader.pagesize=5
infomigr.step1.reader.commit.interval=2

infomigr.step2.reader.sql=SELECT c.ID as CERT_ID, c.SIGNED_DATE, c.DOCUMENT as CERT_JSON FROM CERTIFICATE c LEFT JOIN ORIGINAL_CERTIFICATE oc ON c.ID = oc.CERTIFICATE_ID WHERE UTF8TOSTRING(oc.DOCUMENT) LIKE '%<motivering>%' AND UTF8TOSTRING(oc.DOCUMENT) NOT LIKE '%<prognosangivelse>%' AND c.ID IN (select cs1.CERTIFICATE_ID from CERTIFICATE_STATE cs1 left join CERTIFICATE_STATE cs2 on cs1.CERTIFICATE_ID = cs2.CERTIFICATE_ID where cs1.STATE = 'RECEIVED' and cs2.STATE = 'SENT' and TIMESTAMPDIFF('SECOND', cs1.TIMESTAMP, cs2.TIMESTAMP) > 1) AND c.ID NOT IN (SELECT cs2.CERTIFICATE_ID FROM CERTIFICATE_STATE cs2 WHERE cs2.STATE = 'CANCELLED')
infomigr.step2.reader.commit.interval=2
