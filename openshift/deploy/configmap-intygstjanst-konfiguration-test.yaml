apiVersion: v1
data:
  certificate-logback.xml: |
    <?xml version="1.0" encoding="UTF-8" ?>
    <configuration scan="true" scanPeriod="30 seconds">
      <jmxConfigurator />
      <appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">
        <filter class="se.inera.intyg.common.util.logging.MarkerFilter">
            <markers>Validation, Monitoring</markers>
            <onMatch>DENY</onMatch>
            <onMismatch>ACCEPT</onMismatch>
        </filter>
        <encoder>
          <pattern>%date{ISO8601} [%thread] %-5level %logger{10} - %msg%n</pattern>
        </encoder>
      </appender>

      <!--Daily rolling file appender -->
      <appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <filter class="se.inera.intyg.common.util.logging.MarkerFilter">
            <markers>Validation, Monitoring</markers>
            <onMatch>DENY</onMatch>
            <onMismatch>ACCEPT</onMismatch>
        </filter>
        <file>${catalina.base}/logs/certificate.log</file>
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
          <fileNamePattern>${catalina.base}/logs/certificate.%d{yyyy-MM-dd}.log</fileNamePattern>
        </rollingPolicy>
        <encoder>
          <pattern>%date{ISO8601} [%thread] %-5level %logger{10} - %msg%n</pattern>
        </encoder>
      </appender>

      <!--Daily rolling file appender for validation messages -->
      <appender name="VALIDATION" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <filter class="se.inera.intyg.common.util.logging.MarkerFilter">
            <marker>Validation</marker>
            <onMatch>ACCEPT</onMatch>
            <onMismatch>DENY</onMismatch>
        </filter>
        <file>${catalina.base}/logs/validation.log</file>
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
          <fileNamePattern>${catalina.base}/logs/validation.%d{yyyy-MM-dd}.log</fileNamePattern>
        </rollingPolicy>
        <encoder>
          <pattern>%date{ISO8601} %-5level - %msg%n</pattern>
        </encoder>
      </appender>

      <!--Daily rolling file appender for validation messages -->
      <appender name="MONITORING" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <filter class="se.inera.intyg.common.util.logging.MarkerFilter">
            <marker>Monitoring</marker>
            <onMatch>ACCEPT</onMatch>
            <onMismatch>DENY</onMismatch>
        </filter>
        <file>${catalina.base}/logs/monitoring.log</file>
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
          <fileNamePattern>${catalina.base}/logs/monitoring.%d{yyyy-MM-dd}.log</fileNamePattern>
        </rollingPolicy>
        <encoder>
          <pattern>%date{ISO8601} %-5level - %msg%n</pattern>
        </encoder>
      </appender>

      <logger name="org.springframework" level="error" />

      <logger name="org.hibernate" level="error" />
      <logger name="org.hibernate.engine.jdbc.spi.SqlExceptionHelper" level="off" />

      <logger name="org.apache.camel" level="WARN" />
      <logger name="org.apache.cxf" level="error" />

      <logger name="se.inera.intyg.intygstjanst" level="warn" />
      <logger name="se.inera.intyg.intygstjanst.web.integration" level="info" />
      <logger name="se.inera.intyg.intygstjanst.web.service.impl.StatisticsServiceImpl" level="info" />

      <logger name="se.inera.intyg.intygstjanst.web.service.MonitoringLogService" level="info" />

      <root>
        <level value="error" />
        <appender-ref ref="STDOUT" />
        <appender-ref ref="FILE" />
        <appender-ref ref="VALIDATION" />
        <appender-ref ref="MONITORING" />
      </root>

    </configuration>

  certificate.properties: >
    # Configuration and resource folders

    root.config.dir=${certificate.config.folder}

    config.dir=${certificate.config.folder}/intygstjanst-konfiguration


    # Hosts

    localhost.url=http://localhost:8080


    # NTjP SSL config

    ntjp.ws.certificate.file = ${config.dir}/certifikat/demo.intygstjanst.intygstjanster.se.p12

    ntjp.ws.certificate.type = PKCS12

    ntjp.ws.truststore.file = ${config.dir}/certifikat/truststore.jks

    ntjp.ws.truststore.type = JKS


    # Endpoints for communicating with FK

    registermedicalcertificatev3.endpoint.url=${localhost.url}/inera-certificate/register-medical-certificate-stub

    sendmedicalcertificatequestionv1.endpoint.url=${localhost.url}/inera-certificate/send-certificate-question-stub

    sendmessagetocarev2.endpoint.url=${localhost.url}/inera-certificate/send-message-to-care-stub

    sendmessagetorecipientv2.endpoint.url=${localhost.url}/inera-certificate/send-message-to-recipient-stub

    registercertificatev1.endpoint.url=${localhost.url}/inera-certificate/register-certificate-stub

    revokemedicalcertificatev1.endpoint.url=${localhost.url}/inera-certificate/revoke-medical-certificate-stub

    registercertificatev3.endpoint.url=${localhost.url}/inera-certificate/register-certificate-stub-fk-parent

    revokecertificatev2.endpoint.url=${localhost.url}/inera-certificate/revoke-certificate-rivta-stub


    # In this env a test jms receiver is used for integration tests

    statistics.enabled = true


    ################################################

    #

    # HSA-Integration Configurations

    #

    ################################################


    infrastructure.directory.authorizationmanagement.getcredentialsforpersonincludingprotectedpersonresponderinterface.endpoint.url=${localhost.url}/inera-certificate/hsa-authorization

    infrastructure.directory.organization.getunit.endpoint.url=${localhost.url}/inera-certificate/hsa-unit

    infrastructure.directory.organization.gethealthcareunit.endpoint.url=${localhost.url}/inera-certificate/hsa-healthcareunit

    infrastructure.directory.organization.gethealthcareunitmembers.endpoint.url=${localhost.url}/hsa-healthcareunit-members

    infrastructure.directory.employee.getemployee.endpoint.url=${localhost.url}/inera-certificate/hsa-employee


    infrastructure.directory.logicalAddress=


    ################################################

    #

    # HSA/PU ignite cache settings

    #

    ################################################

    cache.ipaddresses=127.0.0.1:47530..47539

    cache.default.expiration.seconds=3600

    cache.bindport=47530

    hsa.unit.cache.expiry=3600

    hsa.healthcareunit.cache.expiry=3600

    hsa.healhcareunitmembers.cache.expiry=3600


    ################################################

    #

    # Recipient properties

    #

    ################################################

    recipients.update.cron = 0 0 * * * *

    recipient.file = ${recipient.config.file}

  recipients.json: |
    [
      {
        "id": "FKASSA",
        "name": "F\u00F6rs\u00E4kringskassan",
        "logicalAddress": "FKORG",
        "certificateTypes": [
          "fk7263",
          "luse",
          "lisjp",
          "luae_fs",
          "luae_na"
        ],
        "active" : true,
        "trusted": true
      },
      {
        "id" : "FBA",
        "name" : "F\u00F6rs\u00E4kringsbolaget AB",
        "logicalAddress" : "fail-adress",
        "certificateTypes" : [
          "lisjp"
        ],
        "active" : true,
        "trusted": false
      },
      {
        "id" : "TRANSP",
        "name" : "Transportstyrelsen",
        "logicalAddress" : "tsTestAdress",
        "certificateTypes" : [
          "ts-bas",
          "ts-diabetes"
        ],
        "active" : true,
        "trusted": true
      },
      {
        "id" : "HSVARD",
        "name" : "Hälso- och sjukvården",
        "logicalAddress" : "hsvardAdress",
        "certificateTypes" : [
          "ts-bas",
          "ts-diabetes",
          "fk7263",
          "lisjp",
          "luse",
          "luae_na",
          "luae_fs"
        ],
        "active" : true,
        "trusted": true
      },
      {
        "id" : "INVANA",
        "name" : "Invånaren",
        "logicalAddress" : "miAdress",
        "certificateTypes" : [
          "ts-bas",
          "ts-diabetes",
          "fk7263",
          "lisjp",
          "luse",
          "luae_na",
          "luae_fs"
        ],
        "active" : true,
        "trusted": true
      },
      {
        "id": "SKV",
        "name": "Skatteverket",
        "logicalAddress": "Skatteverket",
        "certificateTypes" : [
          "db"
        ],
        "active" : true
      },
      {
        "id": "SOS",
        "name": "Socialstyrelsen",
        "logicalAddress": "SOS",
        "certificateTypes" : [
          "doi"
        ],
        "active" : true
      }
    ]
kind: ConfigMap
metadata:
  name: intygstjanst-konfiguration-test
